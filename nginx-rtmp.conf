# RTMP application for stream relay
rtmp {
    server {
        listen 1935;
        chunk_size 4096;
        max_streams 10;
        ping 30s;
        ping_timeout 10s;

        application live {
            live on;
            record off;
            drop_idle_publisher 10s;

            # Authentication callback
            on_publish http://CONTROL_PLANE_IP_HERE:3000/api/auth/stream;
            on_publish_done http://CONTROL_PLANE_IP_HERE:3000/api/auth/stream-end;

            # Push to destinations based on user configuration
            # This will be dynamically updated by the control plane
            # For now, we'll use static destinations that users configure
            # push rtmp://a.rtmp.youtube.com/live2/stream_key_here;
            # push rtmp://live.twitch.tv/app/stream_key_here;
            # push rtmp://live-api-s.facebook.com:80/rtmp/stream_key_here;
        }
    }
}

# HTTP server for stats and health checks
http {
    server {
        listen 80;
        location /stat {
            rtmp_stat all;
            rtmp_stat_stylesheet stat.xsl;
        }

        location /stat.xsl {
            root /usr/share/nginx/html;
        }

        location /health {
            return 200 'ok';
            add_header Content-Type text/plain;
        }
    }
}